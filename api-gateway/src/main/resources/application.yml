server:
  port: 8000

# JWT ì‹œí¬ë¦¿ í‚¤ ì„¤ì • (Kubernetes Secretì—ì„œ ê°’ì„ ì£¼ì…ë°›ìŒ)
jwt:
  secret: ${JWT_SECRET_KEY}

spring:
  application:
    name: api-gateway
  main:
    allow-bean-definition-overriding: true
    web-application-type: reactive  # WebFlux ëª…ì‹œì  ì„¤ì •
  # JPA ë° ë°ì´í„°ë² ì´ìŠ¤ ìë™ ì„¤ì • ì™„ì „ ë¹„í™œì„±í™”
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
      - org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration
      - org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration
      - org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.JpaRepositoriesAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration
      - org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration
      - org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration
  # ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ì™„ì „ ì œê±° (API GatewayëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë¶ˆí•„ìš”)
  datasource:
    url: ""
    username: ""
    password: ""
    driver-class-name: ""
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    database-platform: ""
  # Redis ì„¤ì • (WebFluxìš©)
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms

# ë¡œê¹… ì„¤ì • - ìƒì„¸í•œ ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ë ˆë²¨
logging:
  level:
    root: DEBUG
    com.example.api_gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.web.reactive: DEBUG
    org.springframework.security: DEBUG
    org.springframework.boot.autoconfigure: DEBUG
    org.springframework.boot.autoconfigure.jdbc: DEBUG
    org.springframework.boot.autoconfigure.orm: DEBUG
    org.springframework.boot.autoconfigure.data: DEBUG
    org.springframework.data: DEBUG
    org.springframework.data.redis: DEBUG
    reactor.netty: DEBUG
    io.netty: DEBUG
    io.lettuce: DEBUG
    org.springframework.boot.context.config: DEBUG
    org.springframework.boot.context.properties: DEBUG
    org.springframework.context.annotation: DEBUG
    org.springframework.beans.factory: DEBUG

  cloud:
    gateway:
      default-filters:
        - StripPrefix=1
      routes:
        # ì¸ì¦ ì„œë¹„ìŠ¤ (ê³µê°œ API)
        - id: auth-service-route
          uri: lb://user-service
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1  # /api ì œê±°
            
        # ì‚¬ìš©ì ì„œë¹„ìŠ¤
        - id: user-service-route
          uri: lb://user-service
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=1  # /api ì œê±°
            
        # íˆ¬í‘œ ì„œë¹„ìŠ¤
        - id: vote-service-route
          uri: lb://vote-service
          predicates:
            - Path=/api/vote/**
          filters:
            - StripPrefix=1  # /api ì œê±°
            
        # íŠ¸ë ˆì´ë”© ì„œë¹„ìŠ¤
        - id: trading-service-route
          uri: lb://trading-service
          predicates:
            - Path=/api/trading/**
          filters:
            - StripPrefix=1  # /api ì œê±°
            
        # ê²°ì œ ì„œë¹„ìŠ¤
        - id: pay-service-route
          uri: lb://pay-service
          predicates:
            - Path=/api/pay/**
          filters:
            - StripPrefix=1  # /api ì œê±°

---
# ===============================================
# ğŸŒ³ dev í”„ë¡œíŒŒì¼ (ê°œë°œ í™˜ê²½)
# ===============================================
spring:
  config:
    activate:
      on-profile: "dev"
  data:
    redis:
      host: ${app.redis.host:localhost}
      port: ${app.redis.port:6379}
      password: ${app.redis.password:togather1234}

jwt:
  secret: ${app.jwt.secret:TogatherSecretkey}

server:
  port: 8000

---
# ===============================================
# ğŸš€ main í”„ë¡œíŒŒì¼ (ìš´ì˜ í™˜ê²½)
# ===============================================
spring:
  config:
    activate:
      on-profile: "main"
  data:
    redis:
      host: ${SPRING_DATA_REDIS_HOST:redis}
      port: ${SPRING_DATA_REDIS_PORT:6379}
      password: ${SPRING_DATA_REDIS_PASSWORD:}

logging:
  level:
    root: DEBUG
    com.example.api_gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.web.reactive: DEBUG
    org.springframework.security: DEBUG
    org.springframework.data.redis: DEBUG
    reactor.netty: DEBUG
    io.netty: DEBUG

jwt:
  secret: ${JWT_SECRET_KEY:TogatherSecretkey}

server:
  port: 8000