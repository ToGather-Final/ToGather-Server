# nginx/nginx.conf

# events 블록은 필수로 존재해야 합니다.
events {}

# HTTP 관련 설정을 정의합니다.
http {
    # 가상 서버 하나를 정의합니다.
    server {
        # 컨테이너의 80번 포트에서 요청을 수신합니다.
        listen 80;

        # 1. API 요청 처리 규칙
        # /api/ 로 시작하는 모든 요청은 이 블록에서 처리됩니다.
        location /api/ {
            # 요청을 'api-gateway'라는 이름의 Kubernetes Service로 전달합니다.
            # 포트는 api-gateway Service에 설정된 8000번 포트를 사용합니다.
            proxy_pass http://api-gateway:8000;

            # 클라이언트의 원래 요청 정보를 백엔드에 전달하기 위한 표준 헤더 설정입니다.
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # 2. 프론트엔드 정적 파일 처리 규칙
        # 위 /api/ 규칙에 해당하지 않는 모든 요청은 이 블록에서 처리됩니다.
        location / {
            # 파일의 기본 경로를 Dockerfile에서 복사한 위치로 지정합니다.
            root   /usr/share/nginx/html;
            # 경로에 파일 이름이 없으면 기본으로 index.html을 보여줍니다.
            index  index.html;
            # React/Vue/Angular 같은 SPA(Single Page Application)에서 라우팅이 정상 동작하도록 설정합니다.
            # 요청한 파일이 없으면 404 에러 대신 index.html을 반환합니다.
            try_files $uri $uri/ /index.html;
        }
    }
}